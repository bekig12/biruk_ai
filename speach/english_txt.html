<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Auto Listening & Speaking</title>
<script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>  
<style>
/* ===== MAIN PAGE STYLES ===== */
html, body { margin:0; padding:0; font-family: Arial; height:100%; display:flex; flex-direction:column; background:#fff;}
.top { width:100%; display:flex; justify-content:space-between; align-items:center; padding:6px 8px; background:#a3f2f7; box-sizing:border-box;}
.title { font-size:14px; font-weight:bold; color:#000;}
.controls { display:flex; gap:6px; }
.theme-switch { padding:6px 12px; border-radius:20px; border:1px solid #000; background:#000; color:#fff; font-size:13px; cursor:pointer; }
.hamburger { font-size:22px; cursor:pointer; width:38px; height:38px; display:flex; justify-content:center; align-items:center; border-radius:50%; background:#a3f2f7; color:#000;}
.menu { display:none; position:absolute; top:48px; right:10px; background:#fff; border:1px solid #000; border-radius:6px; box-shadow:0 2px 8px rgba(0,0,0,0.2); z-index:100;flex-direction:column}
.menu button,a { width:100%; padding:8px 12px; border:none; background:none; cursor:pointer; text-align:left;}

.menu button:hover,a:hover { background:#eee; }
textarea { width:100%; flex:1; border:none; outline:none; resize:none; padding:16px; font-size:18px; line-height:1.6; box-sizing:border-box; background:#fff; color:#000;}
.footer { background:#000; color:#fff; text-align:center; padding:5px; font-size:14px;}
body.dark textarea { background:#000; color:#fff;}
body.dark { background:#000;}
body.dark .theme-switch { background:#fff; color:#000; border-color:#fff;}
@media(max-width:600px){ textarea{font-size:16px;} .footer{font-size:12px;}}

/* ===== SETTINGS LOGIN MODAL ===== */
#settingsModal {
  display:none;
  position:fixed;
  top:0; left:0;
  width:100%; height:100%;
  background: rgba(0,0,0,0.6);
  justify-content:center;
  align-items:center;
  z-index:200;
}

#loginContent {
  background:#1e1e1e;
  padding:25px 20px;
  border-radius:12px;
  width:90%;
  max-width:350px;
  text-align:center;
  color:#fff;
  box-shadow:0 10px 25px rgba(0,0,0,0.5);
}

#loginContent h2 {
  margin-top:0;
  margin-bottom:15px;
  font-size:20px;
}

#loginContent input[type="password"] {
  width:100%;
  padding:10px 12px;
  margin-bottom:15px;
  border-radius:8px;
  border:none;
  font-size:14px;
}

#loginContent button {
  width:48%;
  padding:10px 0;
  margin:4px 1%;
  border:none;
  border-radius:8px;
  font-size:14px;
  cursor:pointer;
  transition:all 0.2s ease;
}

#loginContent button:first-of-type {
  background-color:#2ecc71;
  color:#fff;
}
#loginContent button:first-of-type:hover { background-color:#27ae60; }

#loginContent button:last-of-type {
  background-color:#7f8c8d;
  color:#fff;
}
#loginContent button:last-of-type:hover { background-color:#606060; }

/* ===== EDITOR MODAL (after login) ===== */
#editorContent {
  display:none;
  background:#f9f9f9;
  padding:25px 20px;
  border-radius:12px;
  width:90%;
  max-width:400px;
  text-align:left;
  box-shadow:0 8px 20px rgba(0,0,0,0.25);
  position:relative;
  color:#333;
}

#editorContent h2 { margin-top:0; font-size:20px; text-align:center; }
#editorContent label { display:block; margin:12px 0 6px; font-weight:bold; }
#editorContent input[type="text"], #editorContent input[type="file"] {
  width:100%;
  padding:8px 10px;
  margin-bottom:12px;
  border:1px solid #ccc;
  border-radius:6px;
  font-size:14px;
  box-sizing:border-box;
}

#editorContent button {
  padding:10px 16px;
  margin-top:8px;
  margin-right:6px;
  border:none;
  border-radius:6px;
  cursor:pointer;
  font-size:14px;
  transition:background 0.2s ease, transform 0.1s ease;
}

#editorContent button:first-of-type { background:#4CAF50; color:#fff; }
#editorContent button:first-of-type:hover { background:#45a049; transform:translateY(-1px); }
#editorContent button:last-of-type { background:#f44336; color:#fff; }
#editorContent button:last-of-type:hover { background:#d73833; transform:translateY(-1px); }

@media(max-width:480px){
  #editorContent { padding:20px 15px; }
  #editorContent h2 { font-size:18px; }
  #editorContent button { width:48%; font-size:13px; }
}
</style>
</head>

<body class="bg-amber-600">

<div class="top">
  <span class="title">Ai powered management system</span>
  <div class="controls">
    <button class="theme-switch" onclick="toggleTheme()">Dark</button>
    <span class="hamburger" onclick="toggleMenu()">‚ò∞</span>
  </div>
  <div class="menu" id="menu" class="px-2 flex flex-col">
       <a href="/english" id="btnEn" >English</a>
      <a href="/" id="btnAm" >Amharic</a>
      <a href="/haddiyisa" id="btnAm" >Haddiyisa</a>
      <a href="/englishTxt" id="btnEn" >English T</a>
      <a href="/amharicTxt" id="btnAm" >Amharic T</a> 
      <a href="/haddiyisaT" id="btnEn" >Haddiyisa T</a>
    <button onclick="openSettings()">Setting ‚öôÔ∏è</button>
  </div>
</div>

<textarea readonly id="output" placeholder="English voice recognition"></textarea>

<div class="footer">¬© Developed By Innovator Biruk Girma üá™üáπ 2025</div>

<!-- FULLSCREEN SETTINGS MODAL -->
<div id="settingsModal">
  <!-- LOGIN CONTENT -->
  <div id="loginContent">
    <h2>üîí Editor Login</h2>
    <input type="password" id="passwordInput" placeholder="Password">
    <button onclick="checkPassword()">Login</button>
    <button onclick="closeSettings()">Close</button>
  </div>

  <!-- EDITOR CONTENT -->
  <div id="editorContent">
    <h2>App Settings</h2>
    <label>English Placeholder Text:</label>
    <input class="bg-amber-700" type="text" id="englishPlaceholder" placeholder="English voice recognition">
    <label>Amharic Placeholder Text:</label>
    <input type="text" id="amharicPlaceholder" placeholder="·ä†·àõ·à≠·äõ ·ãµ·àù·çÖ">
    <label>English Intro Audio:</label>
    <input type="file" id="englishAudio" accept="audio/*">
    <label>Amharic Intro Audio:</label>
    <input type="file" id="amharicAudio" accept="audio/*">
    <button onclick="saveSettings()">Save Settings</button>
    <button onclick="closeSettings()">Cancel</button>
  </div>
</div>

<script>
/* ===============================
   MENU + THEME (UNCHANGED)
================================ */
const menu = document.getElementById("menu");
function toggleMenu(){
  menu.style.display = menu.style.display === "flex" ? "none" : "flex";
}
function toggleTheme(){
  document.body.classList.toggle("dark");
}

/* ===============================
   SETTINGS MODAL (UNCHANGED)
================================ */
const settingsModal = document.getElementById("settingsModal");
const loginContent = document.getElementById("loginContent");
const editorContent = document.getElementById("editorContent");

function openSettings(){
  settingsModal.style.display = "flex";
  loginContent.style.display = "block";
  editorContent.style.display = "none";
  document.getElementById("passwordInput").value = "";
}

function checkPassword(){
  const pwd = document.getElementById("passwordInput").value;
  if(pwd === "1234"){
    loginContent.style.display = "none";
    editorContent.style.display = "block";

    const en = localStorage.getItem("placeholder_en");
    const am = localStorage.getItem("placeholder_am");
    if(en) document.getElementById("englishPlaceholder").value = en;
    if(am) document.getElementById("amharicPlaceholder").value = am;
  } else {
    alert("Incorrect password!");
  }
}

function closeSettings(){
  settingsModal.style.display = "none";
}

function saveSettings(){
  const enText = document.getElementById("englishPlaceholder").value;
  const amText = document.getElementById("amharicPlaceholder").value;

  if(enText) localStorage.setItem("placeholder_en", enText);
  if(amText) localStorage.setItem("placeholder_am", amText);

  alert("Settings saved!");
  closeSettings();
}

/* ===============================
   AMHARIC SPEECH RECOGNITION
   (NEW ‚Äì DOES NOT BREAK OTHERS)
================================ */
const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;

if (!SpeechRecognition) {
  alert("Speech Recognition not supported in this browser");
}

const recognition = new SpeechRecognition();
recognition.lang = "en-US";          // üá™üáπ Amharic
recognition.continuous = false;      // stop after one sentence
recognition.interimResults = false;

const output = document.getElementById("output");

let isProcessing = false;

/* START LISTENING */
function startListening(){
  if(!isProcessing){
    try {
      recognition.start();
    } catch(e) {}
  }
}

/* ON RESULT */
recognition.onresult = async (event) => {
  const amharicText = event.results[0][0].transcript.trim();
  console.log(amharicText,recognition.lang)
  if(!amharicText || isProcessing) return;

  isProcessing = true;
  recognition.stop();

  output.value = "‚è≥ Pendning...\n\n" + amharicText;

  try {
    const response = await fetch(
      "https://biruk-ai.onrender.com/askEnglish",
      {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ question: amharicText })
      }
    );

    const data = await response.json();
    console.log(data)
    output.value = data.answer
      ? data.answer
      : JSON.stringify(data, null, 2);""
      recognition.start();
  } catch (err) {
    output.value = "‚ùå Error\n" + err.message;
  }

  isProcessing = false;
  setTimeout(startListening, 800); // üîÅ restart
};

/* AUTO RESTART IF STOPPED */
recognition.onend = () => {
  if(!isProcessing){
    setTimeout(startListening, 500);
  }
};

function playIntroAudio(){
  if (recognition) recognition.stop();
    };
  const src = "/assets/AmhstartAudio.mp3"
  let audio = new Audio(src);
  audio.autoplay=true; audio.loop=false;
  recognition.stop(); allowRestart=false;
  audio.play().catch(()=>{ document.body.addEventListener("click",()=>audio.play(),{once:true}); });
  audio.onended = ()=>{ startListening()
}
/* START ON PAGE LOAD */
window.addEventListener("DOMContentLoaded", () => {
  const amPlaceholder = localStorage.getItem("placeholder_am");
  if(amPlaceholder) output.placeholder = amPlaceholder;
  playIntroAudio()
});
</script>


</body>
</html>
